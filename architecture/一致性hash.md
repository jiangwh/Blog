# 一致性hash

Hash算法的致命缺点：在节点数量增加或者减少的时候，需要迁移的数据太多。

加入开始有1，2，3个节点，现在增加4号节点。

| 节点 | 数据1 | 数据2 | 数据3 |数据4|
| ---- | ----- | ----- | ----- |---|
| 1    |  a1     |a2       |a3       |a4|
| 2|b1|b2|b3|b4|
| 3|c1|c2|c3|c4|

增加4号节点之后的数据分布

| 节点 | 数据1 | 数据2 | 数据3 |
| ---- | ----- | ----- | ----- |
| 1    | a1    |b2      |   c3    |
|2|b1|c2|a4|
|3|c1|a3|b4|
|4|a2|b3|c4|

12条数据中只有3条数据无需迁移，那么前面节点中75%的数据需要迁移。

一致性hash算法可以缓解该问题，一致性hash使用环状hash。

环状hash是通过hash范围处理。

按照前面的数据，如果增加4号节点，那么需要迁移的只有1、3号节点中数据。1、3节点中数据落到4号节点上面数据进行迁移。那么迁移的数据应该2-4条记录，节点越多，迁移数据量占比越少。





